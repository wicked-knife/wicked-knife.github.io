<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MongoDB 管道操作符 | 冯罡的博客</title>
    <meta name="description" content="冯罡的博客">
    
    
    <link rel="preload" href="/assets/css/0.styles.e9c611b2.css" as="style"><link rel="preload" href="/assets/js/app.ff403cda.js" as="script"><link rel="preload" href="/assets/js/4.f4d4fcf2.js" as="script"><link rel="prefetch" href="/assets/js/10.a459bc4b.js"><link rel="prefetch" href="/assets/js/2.1a3627a8.js"><link rel="prefetch" href="/assets/js/3.25b87011.js"><link rel="prefetch" href="/assets/js/5.75e19f3e.js"><link rel="prefetch" href="/assets/js/6.57b5fdce.js"><link rel="prefetch" href="/assets/js/7.78af12a0.js"><link rel="prefetch" href="/assets/js/8.8cbd171f.js"><link rel="prefetch" href="/assets/js/9.9c32ee0b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e9c611b2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">冯罡的博客</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/guide/" class="nav-link">目录</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/guide/" class="nav-link">目录</a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>MongoDB 管道操作符</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/database/mongodb-aggregate.html#_1-project" class="sidebar-link">(1) $project</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/database/mongodb-aggregate.html#_2-match" class="sidebar-link">(2) $match</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/database/mongodb-aggregate.html#_3-group" class="sidebar-link">(3) $group</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/database/mongodb-aggregate.html#_4-sort" class="sidebar-link">(4) $sort</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/database/mongodb-aggregate.html#_5-limit" class="sidebar-link">(5) $limit</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/database/mongodb-aggregate.html#_6-skip" class="sidebar-link">(6) $skip</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/database/mongodb-aggregate.html#_7-lookup" class="sidebar-link">(7) $lookup</a><ul class="sidebar-sub-headers"></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="mongodb-管道操作符"><a href="#mongodb-管道操作符" aria-hidden="true" class="header-anchor">#</a> MongoDB 管道操作符</h1> <p>假设数据库user下有两个集合userinfo和userfrom.</p> <p>userinfo集合中的数据:</p> <p><img src="http://ww1.sinaimg.cn/large/e3507465gy1fx46ytsk6ej20sw09njs1.jpg" alt></p> <p>userfrom集合中的数据:</p> <p><img src="http://ww1.sinaimg.cn/large/e3507465gy1fx46zb0a7uj20f402vglj.jpg" alt></p> <h2 id="_1-project"><a href="#_1-project" aria-hidden="true" class="header-anchor">#</a> (1) $project</h2> <p>管道操作符$project用来控制查询结果显示的字段，下方语句表示查询出来的文档
显示其name和from字段</p> <div class="language-js extra-class"><pre class="language-js"><code>db<span class="token punctuation">.</span>userinfo<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
          $project<span class="token punctuation">:</span> <span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">from</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p>result:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token punctuation">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">&quot;5be18c280fd50eed27a00afd&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;浩克&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;from&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;earth&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token punctuation">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">&quot;5be6c06943778816488aef97&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;灭霸&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;from&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;cosmos&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token punctuation">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">&quot;5be6c4a3a1641007e09ab933&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;格鲁特&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;from&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;cosmos&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token punctuation">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">&quot;5be6ff36f2bac600909026c3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;星爵&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;from&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;cosmos&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token punctuation">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">&quot;5be7aef53ea0520550796519&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;火箭浣熊&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;from&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;cosmos&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token punctuation">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">&quot;5be7d3703ea052055079651a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;索尔&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;from&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;cosmos&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token punctuation">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">&quot;5be7d52873ae2929fc5670d8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;美国队长&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;from&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;earth&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token punctuation">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">&quot;5be7d53773ae2929fc5670d9&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;钢铁侠&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;from&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;earth&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token punctuation">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">&quot;5be7da14fc0402147c12055a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;曼哈顿博士&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;from&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;earth&quot;</span> <span class="token punctuation">}</span>
</code></pre></div><h2 id="_2-match"><a href="#_2-match" aria-hidden="true" class="header-anchor">#</a> (2) $match</h2> <p>管道操作符$match用来筛选数据,下方语句表示筛选age字段值大于100且from字段值等于’earth’的文档。当age字段值类型为String时，无法进行比较。</p> <p>以下语句$match和$project管道顺序调换后无法正常查询到数据，是因为$project控制文档显示的字段为name和from，所以age无法进行比较，所以无法正常查询到数据。在书写数据库查询语句时应注意这点！</p> <div class="language-js extra-class"><pre class="language-js"><code>db<span class="token punctuation">.</span>userinfo<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        $match<span class="token punctuation">:</span> <span class="token punctuation">{</span>age<span class="token punctuation">:</span> <span class="token punctuation">{</span>$gt<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">from</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>$eq<span class="token punctuation">:</span> <span class="token string">'earth'</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        $project<span class="token punctuation">:</span> <span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">from</span> <span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p>result:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token punctuation">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">&quot;5be7da14fc0402147c12055a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;曼哈顿博士&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;from&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;earth&quot;</span> <span class="token punctuation">}</span>
</code></pre></div><h2 id="_3-group"><a href="#_3-group" aria-hidden="true" class="header-anchor">#</a> (3) $group</h2> <p>管道操作符$group用于将集合中的文档分组，一般用来统计结果。</p> <div class="language-js extra-class"><pre class="language-js"><code>db<span class="token punctuation">.</span>userinfo<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        $group<span class="token punctuation">:</span> <span class="token punctuation">{</span>_id<span class="token punctuation">:</span> <span class="token string">'$from'</span><span class="token punctuation">,</span> count<span class="token punctuation">:</span> <span class="token punctuation">{</span>$sum<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p>result:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;cosmos&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;count&quot;</span> <span class="token punctuation">:</span> <span class="token number">5</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;earth&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;count&quot;</span> <span class="token punctuation">:</span> <span class="token number">4</span> <span class="token punctuation">}</span>
</code></pre></div><h2 id="_4-sort"><a href="#_4-sort" aria-hidden="true" class="header-anchor">#</a> (4) $sort</h2> <p>管道操作符$group用于将集合中的文档排序。1为升序，-1为降序。</p> <div class="language-js extra-class"><pre class="language-js"><code>db<span class="token punctuation">.</span>userinfo<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        $project<span class="token punctuation">:</span> <span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        $sort<span class="token punctuation">:</span> <span class="token punctuation">{</span>age<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p>result:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token punctuation">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">&quot;5be6c4a3a1641007e09ab933&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;格鲁特&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span> <span class="token punctuation">:</span> <span class="token number">3</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token punctuation">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">&quot;5be7aef53ea0520550796519&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;火箭浣熊&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span> <span class="token punctuation">:</span> <span class="token number">30</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token punctuation">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">&quot;5be6ff36f2bac600909026c3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;星爵&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span> <span class="token punctuation">:</span> <span class="token number">33</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token punctuation">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">&quot;5be7d53773ae2929fc5670d9&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;钢铁侠&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span> <span class="token punctuation">:</span> <span class="token number">44</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token punctuation">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">&quot;5be18c280fd50eed27a00afd&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;浩克&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span> <span class="token punctuation">:</span> <span class="token number">45</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token punctuation">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">&quot;5be7d52873ae2929fc5670d8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;美国队长&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span> <span class="token punctuation">:</span> <span class="token number">80</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token punctuation">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">&quot;5be7da14fc0402147c12055a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;曼哈顿博士&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span> <span class="token punctuation">:</span> <span class="token number">150</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token punctuation">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">&quot;5be7d3703ea052055079651a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;索尔&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span> <span class="token punctuation">:</span> <span class="token number">1500</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token punctuation">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">&quot;5be6c06943778816488aef97&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;灭霸&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span> <span class="token punctuation">:</span> <span class="token number">2000</span> <span class="token punctuation">}</span>
</code></pre></div><h2 id="_5-limit"><a href="#_5-limit" aria-hidden="true" class="header-anchor">#</a> (5) $limit</h2> <p>管道操作符$limit用来限制文档查询数量。</p> <div class="language-js extra-class"><pre class="language-js"><code>db<span class="token punctuation">.</span>userinfo<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        $match<span class="token punctuation">:</span> <span class="token punctuation">{</span>age<span class="token punctuation">:</span> <span class="token punctuation">{</span>$gt<span class="token punctuation">:</span> <span class="token number">35</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        $sort<span class="token punctuation">:</span> <span class="token punctuation">{</span>age<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span>  
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        $limit<span class="token punctuation">:</span> <span class="token number">3</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p>result:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token punctuation">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">&quot;5be7d53773ae2929fc5670d9&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;钢铁侠&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span> <span class="token punctuation">:</span> <span class="token number">44</span><span class="token punctuation">,</span> <span class="token string">&quot;from&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;earth&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token punctuation">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">&quot;5be18c280fd50eed27a00afd&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;浩克&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span> <span class="token punctuation">:</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token string">&quot;from&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;earth&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token punctuation">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">&quot;5be7d52873ae2929fc5670d8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;美国队长&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span> <span class="token punctuation">:</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token string">&quot;from&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;earth&quot;</span> <span class="token punctuation">}</span>
</code></pre></div><h2 id="_6-skip"><a href="#_6-skip" aria-hidden="true" class="header-anchor">#</a> (6) $skip</h2> <p>管道操作符$skip用来跳过一定数量的查询到的文档。</p> <div class="language-js extra-class"><pre class="language-js"><code>db<span class="token punctuation">.</span>userinfo<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        $match<span class="token punctuation">:</span> <span class="token punctuation">{</span>age<span class="token punctuation">:</span> <span class="token punctuation">{</span>$gt<span class="token punctuation">:</span> <span class="token number">35</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        $sort<span class="token punctuation">:</span> <span class="token punctuation">{</span>age<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span>  
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        $limit<span class="token punctuation">:</span> <span class="token number">3</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        $skip<span class="token punctuation">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p>result:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token punctuation">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">&quot;5be18c280fd50eed27a00afd&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;浩克&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span> <span class="token punctuation">:</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token string">&quot;from&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;earth&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token punctuation">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">&quot;5be7d52873ae2929fc5670d8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;美国队长&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span> <span class="token punctuation">:</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token string">&quot;from&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;earth&quot;</span> <span class="token punctuation">}</span>
</code></pre></div><p>当交换$limit和$skip的管道顺序时，查询到的结果是不一样的。交换后的result:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token punctuation">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">&quot;5be18c280fd50eed27a00afd&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;浩克&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span> <span class="token punctuation">:</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token string">&quot;from&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;earth&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token punctuation">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">&quot;5be7d52873ae2929fc5670d8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;美国队长&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span> <span class="token punctuation">:</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token string">&quot;from&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;earth&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token punctuation">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">&quot;5be7da14fc0402147c12055a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;曼哈顿博士&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span> <span class="token punctuation">:</span> <span class="token number">150</span><span class="token punctuation">,</span> <span class="token string">&quot;from&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;earth&quot;</span> <span class="token punctuation">}</span>
</code></pre></div><h2 id="_7-lookup"><a href="#_7-lookup" aria-hidden="true" class="header-anchor">#</a> (7) $lookup</h2> <p>管道操作符$lookup主要用来将多个集合进行关联查询。以下语句根据userfrom集合的comefrom字段对userinfo集合的文档进行关联查询。并将查询到的文档放到heros字段下。</p> <div class="language-js extra-class"><pre class="language-js"><code>db<span class="token punctuation">.</span>userfrom<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        $lookup<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token keyword">from</span><span class="token punctuation">:</span> <span class="token string">'userinfo'</span><span class="token punctuation">,</span>
            localField<span class="token punctuation">:</span> <span class="token string">'comefrom'</span><span class="token punctuation">,</span>
            foreignField<span class="token punctuation">:</span> <span class="token string">'from'</span><span class="token punctuation">,</span>
            <span class="token keyword">as</span><span class="token punctuation">:</span> <span class="token string">'heros'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p>result:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token punctuation">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">&quot;5be7e28b7dbe653350b3d151&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;comefrom&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;earth&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;heros&quot;</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token punctuation">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">&quot;5be18c280fd50eed27a00afd&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;浩克&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span> <span class="token punctuation">:</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token string">&quot;from&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;earth&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token punctuation">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">&quot;5be7d52873ae2929fc5670d8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;美 国队长&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span> <span class="token punctuation">:</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token string">&quot;from&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;earth&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token punctuation">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">&quot;5be7d53773ae2929fc5670d9&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;钢铁侠&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span> <span class="token punctuation">:</span> <span class="token number">44</span><span class="token punctuation">,</span> <span class="token string">&quot;from&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;earth&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token punctuation">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">&quot;5be7da14fc0402147c12055a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;曼哈顿博士&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span> <span class="token punctuation">:</span> <span class="token number">150</span><span class="token punctuation">,</span> <span class="token string">&quot;from&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;earth&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token punctuation">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">&quot;5be7e2977dbe653350b3d152&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;comefrom&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;cosmos&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;heros&quot;</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token punctuation">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">&quot;5be6c06943778816488aef97&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;灭霸&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span> <span class="token punctuation">:</span> <span class="token number">2000</span><span class="token punctuation">,</span> <span class="token string">&quot;from&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;cosmos&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token punctuation">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">&quot;5be6c4a3a1641007e09ab933&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;格鲁特&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span> <span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;from&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;cosmos&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token punctuation">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">&quot;5be6ff36f2bac600909026c3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;星爵&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span> <span class="token punctuation">:</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token string">&quot;from&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;cosmos&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token punctuation">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">&quot;5be7aef53ea0520550796519&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;火箭浣熊&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span> <span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token string">&quot;from&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;cosmos&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token punctuation">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token string">&quot;5be7d3703ea052055079651a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;索尔&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span> <span class="token punctuation">:</span> <span class="token number">1500</span><span class="token punctuation">,</span> <span class="token string">&quot;from&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;cosmos&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span>
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.ff403cda.js" defer></script><script src="/assets/js/4.f4d4fcf2.js" defer></script>
  </body>
</html>
